2018-12-26 13:42:05.467210: I tensorflow/core/platform/cpu_feature_guard.cc:141] Your CPU supports instructions that this TensorFlow binary was not compiled to use: SSE4.1 SSE4.2 AVX AVX2 FMA
2018-12-26 13:42:05.562672: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:964] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero
2018-12-26 13:42:05.563011: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1432] Found device 0 with properties: 
name: GeForce GTX 1080 Ti major: 6 minor: 1 memoryClockRate(GHz): 1.582
pciBusID: 0000:01:00.0
totalMemory: 10.91GiB freeMemory: 10.04GiB
2018-12-26 13:42:05.563025: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1511] Adding visible gpu devices: 0
2018-12-26 13:42:05.739985: I tensorflow/core/common_runtime/gpu/gpu_device.cc:982] Device interconnect StreamExecutor with strength 1 edge matrix:
2018-12-26 13:42:05.740023: I tensorflow/core/common_runtime/gpu/gpu_device.cc:988]      0 
2018-12-26 13:42:05.740028: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1001] 0:   N 
2018-12-26 13:42:05.740201: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1115] Created TensorFlow device (/job:localhost/replica:0/task:0/device:GPU:0 with 9708 MB memory) -> physical GPU (device: 0, name: GeForce GTX 1080 Ti, pci bus id: 0000:01:00.0, compute capability: 6.1)



================================================================================
working on: Open file
================================================================================



================================================================================
working on: get training and testing generators
================================================================================
Loading previous validation split...
training_list: [2, 1, 3, 4]
>> training data generator
>> valid data generator
>> compute number of training and validation steps
Number of training steps:  8
Number of validation steps:  2
------------------------------------------------------------
# Load or init model
------------------------------------------------------------
init densenet model
!! train on single gpu
__________________________________________________________________________________________________
Layer (type)                    Output Shape         Param #     Connected to                     
==================================================================================================
input_1 (InputLayer)            (None, 4, 128, 128,  0                                            
__________________________________________________________________________________________________
initial_conv2D (Conv3D)         (None, 48, 128, 128, 5184        input_1[0][0]                    
__________________________________________________________________________________________________
initial_in (InstanceNormalizati (None, 48, 128, 128, 96          initial_conv2D[0][0]             
__________________________________________________________________________________________________
leaky_re_lu_1 (LeakyReLU)       (None, 48, 128, 128, 0           initial_in[0][0]                 
__________________________________________________________________________________________________
dense_0_0_in (InstanceNormaliza (None, 48, 128, 128, 96          leaky_re_lu_1[0][0]              
__________________________________________________________________________________________________
leaky_re_lu_2 (LeakyReLU)       (None, 48, 128, 128, 0           dense_0_0_in[0][0]               
__________________________________________________________________________________________________
dense_0_0_conv2D (Conv3D)       (None, 16, 128, 128, 20736       leaky_re_lu_2[0][0]              
__________________________________________________________________________________________________
concatenate_1 (Concatenate)     (None, 64, 128, 128, 0           leaky_re_lu_1[0][0]              
                                                                 dense_0_0_conv2D[0][0]           
__________________________________________________________________________________________________
dense_0_1_in (InstanceNormaliza (None, 64, 128, 128, 128         concatenate_1[0][0]              
__________________________________________________________________________________________________
leaky_re_lu_3 (LeakyReLU)       (None, 64, 128, 128, 0           dense_0_1_in[0][0]               
__________________________________________________________________________________________________
dense_0_1_conv2D (Conv3D)       (None, 16, 128, 128, 27648       leaky_re_lu_3[0][0]              
__________________________________________________________________________________________________
concatenate_2 (Concatenate)     (None, 80, 128, 128, 0           concatenate_1[0][0]              
                                                                 dense_0_1_conv2D[0][0]           
__________________________________________________________________________________________________
dense_0_2_in (InstanceNormaliza (None, 80, 128, 128, 160         concatenate_2[0][0]              
__________________________________________________________________________________________________
leaky_re_lu_4 (LeakyReLU)       (None, 80, 128, 128, 0           dense_0_2_in[0][0]               
__________________________________________________________________________________________________
dense_0_2_conv2D (Conv3D)       (None, 16, 128, 128, 34560       leaky_re_lu_4[0][0]              
__________________________________________________________________________________________________
concatenate_3 (Concatenate)     (None, 96, 128, 128, 0           concatenate_2[0][0]              
                                                                 dense_0_2_conv2D[0][0]           
__________________________________________________________________________________________________
dense_0_3_in (InstanceNormaliza (None, 96, 128, 128, 192         concatenate_3[0][0]              
__________________________________________________________________________________________________
leaky_re_lu_5 (LeakyReLU)       (None, 96, 128, 128, 0           dense_0_3_in[0][0]               
__________________________________________________________________________________________________
dense_0_3_conv2D (Conv3D)       (None, 16, 128, 128, 41472       leaky_re_lu_5[0][0]              
__________________________________________________________________________________________________
concatenate_4 (Concatenate)     (None, 112, 128, 128 0           concatenate_3[0][0]              
                                                                 dense_0_3_conv2D[0][0]           
__________________________________________________________________________________________________
tr_0_in (InstanceNormalization) (None, 112, 128, 128 224         concatenate_4[0][0]              
__________________________________________________________________________________________________
leaky_re_lu_6 (LeakyReLU)       (None, 112, 128, 128 0           tr_0_in[0][0]                    
__________________________________________________________________________________________________
tr_0_conv2D (Conv3D)            (None, 112, 128, 128 12544       leaky_re_lu_6[0][0]              
__________________________________________________________________________________________________
max_pooling3d_1 (MaxPooling3D)  (None, 112, 64, 64,  0           tr_0_conv2D[0][0]                
__________________________________________________________________________________________________
dense_1_0_in (InstanceNormaliza (None, 112, 64, 64,  224         max_pooling3d_1[0][0]            
__________________________________________________________________________________________________
leaky_re_lu_7 (LeakyReLU)       (None, 112, 64, 64,  0           dense_1_0_in[0][0]               
__________________________________________________________________________________________________
dense_1_0_conv2D (Conv3D)       (None, 16, 64, 64, 6 48384       leaky_re_lu_7[0][0]              
__________________________________________________________________________________________________
concatenate_5 (Concatenate)     (None, 128, 64, 64,  0           max_pooling3d_1[0][0]            
                                                                 dense_1_0_conv2D[0][0]           
__________________________________________________________________________________________________
dense_1_1_in (InstanceNormaliza (None, 128, 64, 64,  256         concatenate_5[0][0]              
__________________________________________________________________________________________________
leaky_re_lu_8 (LeakyReLU)       (None, 128, 64, 64,  0           dense_1_1_in[0][0]               
__________________________________________________________________________________________________
dense_1_1_conv2D (Conv3D)       (None, 16, 64, 64, 6 55296       leaky_re_lu_8[0][0]              
__________________________________________________________________________________________________
concatenate_6 (Concatenate)     (None, 144, 64, 64,  0           concatenate_5[0][0]              
                                                                 dense_1_1_conv2D[0][0]           
__________________________________________________________________________________________________
dense_1_2_in (InstanceNormaliza (None, 144, 64, 64,  288         concatenate_6[0][0]              
__________________________________________________________________________________________________
leaky_re_lu_9 (LeakyReLU)       (None, 144, 64, 64,  0           dense_1_2_in[0][0]               
__________________________________________________________________________________________________
dense_1_2_conv2D (Conv3D)       (None, 16, 64, 64, 6 62208       leaky_re_lu_9[0][0]              
__________________________________________________________________________________________________
concatenate_7 (Concatenate)     (None, 160, 64, 64,  0           concatenate_6[0][0]              
                                                                 dense_1_2_conv2D[0][0]           
__________________________________________________________________________________________________
dense_1_3_in (InstanceNormaliza (None, 160, 64, 64,  320         concatenate_7[0][0]              
__________________________________________________________________________________________________
leaky_re_lu_10 (LeakyReLU)      (None, 160, 64, 64,  0           dense_1_3_in[0][0]               
__________________________________________________________________________________________________
dense_1_3_conv2D (Conv3D)       (None, 16, 64, 64, 6 69120       leaky_re_lu_10[0][0]             
__________________________________________________________________________________________________
concatenate_8 (Concatenate)     (None, 176, 64, 64,  0           concatenate_7[0][0]              
                                                                 dense_1_3_conv2D[0][0]           
__________________________________________________________________________________________________
tr_1_in (InstanceNormalization) (None, 176, 64, 64,  352         concatenate_8[0][0]              
__________________________________________________________________________________________________
leaky_re_lu_11 (LeakyReLU)      (None, 176, 64, 64,  0           tr_1_in[0][0]                    
__________________________________________________________________________________________________
tr_1_conv2D (Conv3D)            (None, 176, 64, 64,  30976       leaky_re_lu_11[0][0]             
__________________________________________________________________________________________________
max_pooling3d_2 (MaxPooling3D)  (None, 176, 32, 32,  0           tr_1_conv2D[0][0]                
__________________________________________________________________________________________________
dense_2_0_in (InstanceNormaliza (None, 176, 32, 32,  352         max_pooling3d_2[0][0]            
__________________________________________________________________________________________________
leaky_re_lu_12 (LeakyReLU)      (None, 176, 32, 32,  0           dense_2_0_in[0][0]               
__________________________________________________________________________________________________
dense_2_0_conv2D (Conv3D)       (None, 16, 32, 32, 3 76032       leaky_re_lu_12[0][0]             
__________________________________________________________________________________________________
concatenate_9 (Concatenate)     (None, 192, 32, 32,  0           max_pooling3d_2[0][0]            
                                                                 dense_2_0_conv2D[0][0]           
__________________________________________________________________________________________________
dense_2_1_in (InstanceNormaliza (None, 192, 32, 32,  384         concatenate_9[0][0]              
__________________________________________________________________________________________________
leaky_re_lu_13 (LeakyReLU)      (None, 192, 32, 32,  0           dense_2_1_in[0][0]               
__________________________________________________________________________________________________
dense_2_1_conv2D (Conv3D)       (None, 16, 32, 32, 3 82944       leaky_re_lu_13[0][0]             
__________________________________________________________________________________________________
concatenate_10 (Concatenate)    (None, 208, 32, 32,  0           concatenate_9[0][0]              
                                                                 dense_2_1_conv2D[0][0]           
__________________________________________________________________________________________________
dense_2_2_in (InstanceNormaliza (None, 208, 32, 32,  416         concatenate_10[0][0]             
__________________________________________________________________________________________________
leaky_re_lu_14 (LeakyReLU)      (None, 208, 32, 32,  0           dense_2_2_in[0][0]               
__________________________________________________________________________________________________
dense_2_2_conv2D (Conv3D)       (None, 16, 32, 32, 3 89856       leaky_re_lu_14[0][0]             
__________________________________________________________________________________________________
concatenate_11 (Concatenate)    (None, 224, 32, 32,  0           concatenate_10[0][0]             
                                                                 dense_2_2_conv2D[0][0]           
__________________________________________________________________________________________________
dense_2_3_in (InstanceNormaliza (None, 224, 32, 32,  448         concatenate_11[0][0]             
__________________________________________________________________________________________________
leaky_re_lu_15 (LeakyReLU)      (None, 224, 32, 32,  0           dense_2_3_in[0][0]               
__________________________________________________________________________________________________
dense_2_3_conv2D (Conv3D)       (None, 16, 32, 32, 3 96768       leaky_re_lu_15[0][0]             
__________________________________________________________________________________________________
concatenate_12 (Concatenate)    (None, 240, 32, 32,  0           concatenate_11[0][0]             
                                                                 dense_2_3_conv2D[0][0]           
__________________________________________________________________________________________________
tr_2_in (InstanceNormalization) (None, 240, 32, 32,  480         concatenate_12[0][0]             
__________________________________________________________________________________________________
leaky_re_lu_16 (LeakyReLU)      (None, 240, 32, 32,  0           tr_2_in[0][0]                    
__________________________________________________________________________________________________
tr_2_conv2D (Conv3D)            (None, 240, 32, 32,  57600       leaky_re_lu_16[0][0]             
__________________________________________________________________________________________________
max_pooling3d_3 (MaxPooling3D)  (None, 240, 16, 16,  0           tr_2_conv2D[0][0]                
__________________________________________________________________________________________________
dense_3_0_in (InstanceNormaliza (None, 240, 16, 16,  480         max_pooling3d_3[0][0]            
__________________________________________________________________________________________________
leaky_re_lu_17 (LeakyReLU)      (None, 240, 16, 16,  0           dense_3_0_in[0][0]               
__________________________________________________________________________________________________
dense_3_0_conv2D (Conv3D)       (None, 16, 16, 16, 1 103680      leaky_re_lu_17[0][0]             
__________________________________________________________________________________________________
concatenate_13 (Concatenate)    (None, 256, 16, 16,  0           max_pooling3d_3[0][0]            
                                                                 dense_3_0_conv2D[0][0]           
__________________________________________________________________________________________________
dense_3_1_in (InstanceNormaliza (None, 256, 16, 16,  512         concatenate_13[0][0]             
__________________________________________________________________________________________________
leaky_re_lu_18 (LeakyReLU)      (None, 256, 16, 16,  0           dense_3_1_in[0][0]               
__________________________________________________________________________________________________
dense_3_1_conv2D (Conv3D)       (None, 16, 16, 16, 1 110592      leaky_re_lu_18[0][0]             
__________________________________________________________________________________________________
concatenate_14 (Concatenate)    (None, 272, 16, 16,  0           concatenate_13[0][0]             
                                                                 dense_3_1_conv2D[0][0]           
__________________________________________________________________________________________________
dense_3_2_in (InstanceNormaliza (None, 272, 16, 16,  544         concatenate_14[0][0]             
__________________________________________________________________________________________________
leaky_re_lu_19 (LeakyReLU)      (None, 272, 16, 16,  0           dense_3_2_in[0][0]               
__________________________________________________________________________________________________
dense_3_2_conv2D (Conv3D)       (None, 16, 16, 16, 1 117504      leaky_re_lu_19[0][0]             
__________________________________________________________________________________________________
concatenate_15 (Concatenate)    (None, 288, 16, 16,  0           concatenate_14[0][0]             
                                                                 dense_3_2_conv2D[0][0]           
__________________________________________________________________________________________________
dense_3_3_in (InstanceNormaliza (None, 288, 16, 16,  576         concatenate_15[0][0]             
__________________________________________________________________________________________________
leaky_re_lu_20 (LeakyReLU)      (None, 288, 16, 16,  0           dense_3_3_in[0][0]               
__________________________________________________________________________________________________
dense_3_3_conv2D (Conv3D)       (None, 16, 16, 16, 1 124416      leaky_re_lu_20[0][0]             
__________________________________________________________________________________________________
concatenate_16 (Concatenate)    (None, 304, 16, 16,  0           concatenate_15[0][0]             
                                                                 dense_3_3_conv2D[0][0]           
__________________________________________________________________________________________________
tr_3_in (InstanceNormalization) (None, 304, 16, 16,  608         concatenate_16[0][0]             
__________________________________________________________________________________________________
leaky_re_lu_21 (LeakyReLU)      (None, 304, 16, 16,  0           tr_3_in[0][0]                    
__________________________________________________________________________________________________
tr_3_conv2D (Conv3D)            (None, 304, 16, 16,  92416       leaky_re_lu_21[0][0]             
__________________________________________________________________________________________________
max_pooling3d_4 (MaxPooling3D)  (None, 304, 8, 8, 8) 0           tr_3_conv2D[0][0]                
__________________________________________________________________________________________________
dense_4_0_in (InstanceNormaliza (None, 304, 8, 8, 8) 608         max_pooling3d_4[0][0]            
__________________________________________________________________________________________________
leaky_re_lu_22 (LeakyReLU)      (None, 304, 8, 8, 8) 0           dense_4_0_in[0][0]               
__________________________________________________________________________________________________
dense_4_0_conv2D (Conv3D)       (None, 16, 8, 8, 8)  131328      leaky_re_lu_22[0][0]             
__________________________________________________________________________________________________
concatenate_17 (Concatenate)    (None, 320, 8, 8, 8) 0           max_pooling3d_4[0][0]            
                                                                 dense_4_0_conv2D[0][0]           
__________________________________________________________________________________________________
dense_4_1_in (InstanceNormaliza (None, 320, 8, 8, 8) 640         concatenate_17[0][0]             
__________________________________________________________________________________________________
leaky_re_lu_23 (LeakyReLU)      (None, 320, 8, 8, 8) 0           dense_4_1_in[0][0]               
__________________________________________________________________________________________________
dense_4_1_conv2D (Conv3D)       (None, 16, 8, 8, 8)  138240      leaky_re_lu_23[0][0]             
__________________________________________________________________________________________________
concatenate_18 (Concatenate)    (None, 336, 8, 8, 8) 0           concatenate_17[0][0]             
                                                                 dense_4_1_conv2D[0][0]           
__________________________________________________________________________________________________
dense_4_2_in (InstanceNormaliza (None, 336, 8, 8, 8) 672         concatenate_18[0][0]             
__________________________________________________________________________________________________
leaky_re_lu_24 (LeakyReLU)      (None, 336, 8, 8, 8) 0           dense_4_2_in[0][0]               
__________________________________________________________________________________________________
dense_4_2_conv2D (Conv3D)       (None, 16, 8, 8, 8)  145152      leaky_re_lu_24[0][0]             
__________________________________________________________________________________________________
concatenate_19 (Concatenate)    (None, 352, 8, 8, 8) 0           concatenate_18[0][0]             
                                                                 dense_4_2_conv2D[0][0]           
__________________________________________________________________________________________________
dense_4_3_in (InstanceNormaliza (None, 352, 8, 8, 8) 704         concatenate_19[0][0]             
__________________________________________________________________________________________________
leaky_re_lu_25 (LeakyReLU)      (None, 352, 8, 8, 8) 0           dense_4_3_in[0][0]               
__________________________________________________________________________________________________
dense_4_3_conv2D (Conv3D)       (None, 16, 8, 8, 8)  152064      leaky_re_lu_25[0][0]             
__________________________________________________________________________________________________
concatenate_20 (Concatenate)    (None, 368, 8, 8, 8) 0           concatenate_19[0][0]             
                                                                 dense_4_3_conv2D[0][0]           
__________________________________________________________________________________________________
tr_4_in (InstanceNormalization) (None, 368, 8, 8, 8) 736         concatenate_20[0][0]             
__________________________________________________________________________________________________
leaky_re_lu_26 (LeakyReLU)      (None, 368, 8, 8, 8) 0           tr_4_in[0][0]                    
__________________________________________________________________________________________________
tr_4_conv2D (Conv3D)            (None, 368, 8, 8, 8) 135424      leaky_re_lu_26[0][0]             
__________________________________________________________________________________________________
max_pooling3d_5 (MaxPooling3D)  (None, 368, 4, 4, 4) 0           tr_4_conv2D[0][0]                
__________________________________________________________________________________________________
dense_5_0_in (InstanceNormaliza (None, 368, 4, 4, 4) 736         max_pooling3d_5[0][0]            
__________________________________________________________________________________________________
leaky_re_lu_27 (LeakyReLU)      (None, 368, 4, 4, 4) 0           dense_5_0_in[0][0]               
__________________________________________________________________________________________________
dense_5_0_conv2D (Conv3D)       (None, 16, 4, 4, 4)  158976      leaky_re_lu_27[0][0]             
__________________________________________________________________________________________________
concatenate_21 (Concatenate)    (None, 384, 4, 4, 4) 0           max_pooling3d_5[0][0]            
                                                                 dense_5_0_conv2D[0][0]           
__________________________________________________________________________________________________
dense_5_1_in (InstanceNormaliza (None, 384, 4, 4, 4) 768         concatenate_21[0][0]             
__________________________________________________________________________________________________
leaky_re_lu_28 (LeakyReLU)      (None, 384, 4, 4, 4) 0           dense_5_1_in[0][0]               
__________________________________________________________________________________________________
dense_5_1_conv2D (Conv3D)       (None, 16, 4, 4, 4)  165888      leaky_re_lu_28[0][0]             
__________________________________________________________________________________________________
concatenate_22 (Concatenate)    (None, 400, 4, 4, 4) 0           concatenate_21[0][0]             
                                                                 dense_5_1_conv2D[0][0]           
__________________________________________________________________________________________________
dense_5_2_in (InstanceNormaliza (None, 400, 4, 4, 4) 800         concatenate_22[0][0]             
__________________________________________________________________________________________________
leaky_re_lu_29 (LeakyReLU)      (None, 400, 4, 4, 4) 0           dense_5_2_in[0][0]               
__________________________________________________________________________________________________
dense_5_2_conv2D (Conv3D)       (None, 16, 4, 4, 4)  172800      leaky_re_lu_29[0][0]             
__________________________________________________________________________________________________
concatenate_23 (Concatenate)    (None, 416, 4, 4, 4) 0           concatenate_22[0][0]             
                                                                 dense_5_2_conv2D[0][0]           
__________________________________________________________________________________________________
dense_5_3_in (InstanceNormaliza (None, 416, 4, 4, 4) 832         concatenate_23[0][0]             
__________________________________________________________________________________________________
leaky_re_lu_30 (LeakyReLU)      (None, 416, 4, 4, 4) 0           dense_5_3_in[0][0]               
__________________________________________________________________________________________________
dense_5_3_conv2D (Conv3D)       (None, 16, 4, 4, 4)  179712      leaky_re_lu_30[0][0]             
__________________________________________________________________________________________________
concatenate_25 (Concatenate)    (None, 64, 4, 4, 4)  0           dense_5_0_conv2D[0][0]           
                                                                 dense_5_1_conv2D[0][0]           
                                                                 dense_5_2_conv2D[0][0]           
                                                                 dense_5_3_conv2D[0][0]           
__________________________________________________________________________________________________
tr_up_0_conv2DT (Conv3DTranspos (None, 64, 8, 8, 8)  110656      concatenate_25[0][0]             
__________________________________________________________________________________________________
concatenate_26 (Concatenate)    (None, 432, 8, 8, 8) 0           tr_up_0_conv2DT[0][0]            
                                                                 concatenate_20[0][0]             
__________________________________________________________________________________________________
dense_6_0_in (InstanceNormaliza (None, 432, 8, 8, 8) 864         concatenate_26[0][0]             
__________________________________________________________________________________________________
leaky_re_lu_31 (LeakyReLU)      (None, 432, 8, 8, 8) 0           dense_6_0_in[0][0]               
__________________________________________________________________________________________________
dense_6_0_conv2D (Conv3D)       (None, 16, 8, 8, 8)  186624      leaky_re_lu_31[0][0]             
__________________________________________________________________________________________________
concatenate_27 (Concatenate)    (None, 448, 8, 8, 8) 0           concatenate_26[0][0]             
                                                                 dense_6_0_conv2D[0][0]           
__________________________________________________________________________________________________
dense_6_1_in (InstanceNormaliza (None, 448, 8, 8, 8) 896         concatenate_27[0][0]             
__________________________________________________________________________________________________
leaky_re_lu_32 (LeakyReLU)      (None, 448, 8, 8, 8) 0           dense_6_1_in[0][0]               
__________________________________________________________________________________________________
dense_6_1_conv2D (Conv3D)       (None, 16, 8, 8, 8)  193536      leaky_re_lu_32[0][0]             
__________________________________________________________________________________________________
concatenate_28 (Concatenate)    (None, 464, 8, 8, 8) 0           concatenate_27[0][0]             
                                                                 dense_6_1_conv2D[0][0]           
__________________________________________________________________________________________________
dense_6_2_in (InstanceNormaliza (None, 464, 8, 8, 8) 928         concatenate_28[0][0]             
__________________________________________________________________________________________________
leaky_re_lu_33 (LeakyReLU)      (None, 464, 8, 8, 8) 0           dense_6_2_in[0][0]               
__________________________________________________________________________________________________
dense_6_2_conv2D (Conv3D)       (None, 16, 8, 8, 8)  200448      leaky_re_lu_33[0][0]             
__________________________________________________________________________________________________
concatenate_29 (Concatenate)    (None, 480, 8, 8, 8) 0           concatenate_28[0][0]             
                                                                 dense_6_2_conv2D[0][0]           
__________________________________________________________________________________________________
dense_6_3_in (InstanceNormaliza (None, 480, 8, 8, 8) 960         concatenate_29[0][0]             
__________________________________________________________________________________________________
leaky_re_lu_34 (LeakyReLU)      (None, 480, 8, 8, 8) 0           dense_6_3_in[0][0]               
__________________________________________________________________________________________________
dense_6_3_conv2D (Conv3D)       (None, 16, 8, 8, 8)  207360      leaky_re_lu_34[0][0]             
__________________________________________________________________________________________________
concatenate_31 (Concatenate)    (None, 64, 8, 8, 8)  0           dense_6_0_conv2D[0][0]           
                                                                 dense_6_1_conv2D[0][0]           
                                                                 dense_6_2_conv2D[0][0]           
                                                                 dense_6_3_conv2D[0][0]           
__________________________________________________________________________________________________
tr_up_1_conv2DT (Conv3DTranspos (None, 64, 16, 16, 1 110656      concatenate_31[0][0]             
__________________________________________________________________________________________________
concatenate_32 (Concatenate)    (None, 368, 16, 16,  0           tr_up_1_conv2DT[0][0]            
                                                                 concatenate_16[0][0]             
__________________________________________________________________________________________________
dense_7_0_in (InstanceNormaliza (None, 368, 16, 16,  736         concatenate_32[0][0]             
__________________________________________________________________________________________________
leaky_re_lu_35 (LeakyReLU)      (None, 368, 16, 16,  0           dense_7_0_in[0][0]               
__________________________________________________________________________________________________
dense_7_0_conv2D (Conv3D)       (None, 16, 16, 16, 1 158976      leaky_re_lu_35[0][0]             
__________________________________________________________________________________________________
concatenate_33 (Concatenate)    (None, 384, 16, 16,  0           concatenate_32[0][0]             
                                                                 dense_7_0_conv2D[0][0]           
__________________________________________________________________________________________________
dense_7_1_in (InstanceNormaliza (None, 384, 16, 16,  768         concatenate_33[0][0]             
__________________________________________________________________________________________________
leaky_re_lu_36 (LeakyReLU)      (None, 384, 16, 16,  0           dense_7_1_in[0][0]               
__________________________________________________________________________________________________
dense_7_1_conv2D (Conv3D)       (None, 16, 16, 16, 1 165888      leaky_re_lu_36[0][0]             
__________________________________________________________________________________________________
concatenate_34 (Concatenate)    (None, 400, 16, 16,  0           concatenate_33[0][0]             
                                                                 dense_7_1_conv2D[0][0]           
__________________________________________________________________________________________________
dense_7_2_in (InstanceNormaliza (None, 400, 16, 16,  800         concatenate_34[0][0]             
__________________________________________________________________________________________________
leaky_re_lu_37 (LeakyReLU)      (None, 400, 16, 16,  0           dense_7_2_in[0][0]               
__________________________________________________________________________________________________
dense_7_2_conv2D (Conv3D)       (None, 16, 16, 16, 1 172800      leaky_re_lu_37[0][0]             
__________________________________________________________________________________________________
concatenate_35 (Concatenate)    (None, 416, 16, 16,  0           concatenate_34[0][0]             
                                                                 dense_7_2_conv2D[0][0]           
__________________________________________________________________________________________________
dense_7_3_in (InstanceNormaliza (None, 416, 16, 16,  832         concatenate_35[0][0]             
__________________________________________________________________________________________________
leaky_re_lu_38 (LeakyReLU)      (None, 416, 16, 16,  0           dense_7_3_in[0][0]               
__________________________________________________________________________________________________
dense_7_3_conv2D (Conv3D)       (None, 16, 16, 16, 1 179712      leaky_re_lu_38[0][0]             
__________________________________________________________________________________________________
concatenate_37 (Concatenate)    (None, 64, 16, 16, 1 0           dense_7_0_conv2D[0][0]           
                                                                 dense_7_1_conv2D[0][0]           
                                                                 dense_7_2_conv2D[0][0]           
                                                                 dense_7_3_conv2D[0][0]           
__________________________________________________________________________________________________
tr_up_2_conv2DT (Conv3DTranspos (None, 64, 32, 32, 3 110656      concatenate_37[0][0]             
__________________________________________________________________________________________________
concatenate_38 (Concatenate)    (None, 304, 32, 32,  0           tr_up_2_conv2DT[0][0]            
                                                                 concatenate_12[0][0]             
__________________________________________________________________________________________________
dense_8_0_in (InstanceNormaliza (None, 304, 32, 32,  608         concatenate_38[0][0]             
__________________________________________________________________________________________________
leaky_re_lu_39 (LeakyReLU)      (None, 304, 32, 32,  0           dense_8_0_in[0][0]               
__________________________________________________________________________________________________
dense_8_0_conv2D (Conv3D)       (None, 16, 32, 32, 3 131328      leaky_re_lu_39[0][0]             
__________________________________________________________________________________________________
concatenate_39 (Concatenate)    (None, 320, 32, 32,  0           concatenate_38[0][0]             
                                                                 dense_8_0_conv2D[0][0]           
__________________________________________________________________________________________________
dense_8_1_in (InstanceNormaliza (None, 320, 32, 32,  640         concatenate_39[0][0]             
__________________________________________________________________________________________________
leaky_re_lu_40 (LeakyReLU)      (None, 320, 32, 32,  0           dense_8_1_in[0][0]               
__________________________________________________________________________________________________
dense_8_1_conv2D (Conv3D)       (None, 16, 32, 32, 3 138240      leaky_re_lu_40[0][0]             
__________________________________________________________________________________________________
concatenate_40 (Concatenate)    (None, 336, 32, 32,  0           concatenate_39[0][0]             
                                                                 dense_8_1_conv2D[0][0]           
__________________________________________________________________________________________________
dense_8_2_in (InstanceNormaliza (None, 336, 32, 32,  672         concatenate_40[0][0]             
__________________________________________________________________________________________________
leaky_re_lu_41 (LeakyReLU)      (None, 336, 32, 32,  0           dense_8_2_in[0][0]               
__________________________________________________________________________________________________
dense_8_2_conv2D (Conv3D)       (None, 16, 32, 32, 3 145152      leaky_re_lu_41[0][0]             
__________________________________________________________________________________________________
concatenate_41 (Concatenate)    (None, 352, 32, 32,  0           concatenate_40[0][0]             
                                                                 dense_8_2_conv2D[0][0]           
__________________________________________________________________________________________________
dense_8_3_in (InstanceNormaliza (None, 352, 32, 32,  704         concatenate_41[0][0]             
__________________________________________________________________________________________________
leaky_re_lu_42 (LeakyReLU)      (None, 352, 32, 32,  0           dense_8_3_in[0][0]               
__________________________________________________________________________________________________
dense_8_3_conv2D (Conv3D)       (None, 16, 32, 32, 3 152064      leaky_re_lu_42[0][0]             
__________________________________________________________________________________________________
concatenate_43 (Concatenate)    (None, 64, 32, 32, 3 0           dense_8_0_conv2D[0][0]           
                                                                 dense_8_1_conv2D[0][0]           
                                                                 dense_8_2_conv2D[0][0]           
                                                                 dense_8_3_conv2D[0][0]           
__________________________________________________________________________________________________
tr_up_3_conv2DT (Conv3DTranspos (None, 64, 64, 64, 6 110656      concatenate_43[0][0]             
__________________________________________________________________________________________________
concatenate_44 (Concatenate)    (None, 240, 64, 64,  0           tr_up_3_conv2DT[0][0]            
                                                                 concatenate_8[0][0]              
__________________________________________________________________________________________________
dense_9_0_in (InstanceNormaliza (None, 240, 64, 64,  480         concatenate_44[0][0]             
__________________________________________________________________________________________________
leaky_re_lu_43 (LeakyReLU)      (None, 240, 64, 64,  0           dense_9_0_in[0][0]               
__________________________________________________________________________________________________/home/minhvu/anaconda3/envs/py36/lib/python3.6/site-packages/h5py/__init__.py:36: FutureWarning: Conversion of the second argument of issubdtype from `float` to `np.floating` is deprecated. In future, it will be treated as `np.float64 == np.dtype(float).type`.
  from ._conv import register_converters as _register_converters
/home/minhvu/anaconda3/envs/py36/lib/python3.6/importlib/_bootstrap.py:219: ImportWarning: can't resolve package from __spec__ or __package__, falling back on __name__ and __path__
  return f(*args, **kwds)
/home/minhvu/anaconda3/envs/py36/lib/python3.6/importlib/_bootstrap.py:219: ImportWarning: can't resolve package from __spec__ or __package__, falling back on __name__ and __path__
  return f(*args, **kwds)
/home/minhvu/anaconda3/envs/py36/lib/python3.6/site-packages/tensorflow/python/util/tf_inspect.py:75: DeprecationWarning: inspect.getargspec() is deprecated, use inspect.signature() or inspect.getfullargspec()
  return _inspect.getargspec(target)
/home/minhvu/anaconda3/envs/py36/lib/python3.6/site-packages/tensorflow/python/keras/backend.py:4900: ResourceWarning: unclosed file <_io.TextIOWrapper name='/home/minhvu/.keras/keras.json' mode='r' encoding='UTF-8'>
  _config = json.load(open(_config_path))
/home/minhvu/anaconda3/envs/py36/lib/python3.6/importlib/_bootstrap.py:219: ImportWarning: can't resolve package from __spec__ or __package__, falling back on __name__ and __path__
  return f(*args, **kwds)
/home/minhvu/anaconda3/envs/py36/lib/python3.6/importlib/_bootstrap.py:219: ImportWarning: can't resolve package from __spec__ or __package__, falling back on __name__ and __path__
  return f(*args, **kwds)
/home/minhvu/anaconda3/envs/py36/lib/python3.6/site-packages/tensorflow/python/util/tf_inspect.py:75: DeprecationWarning: inspect.getargspec() is deprecated, use inspect.signature() or inspect.getfullargspec()
  return _inspect.getargspec(target)
/home/minhvu/anaconda3/envs/py36/lib/python3.6/site-packages/tensorflow/python/util/tf_inspect.py:75: DeprecationWarning: inspect.getargspec() is deprecated, use inspect.signature() or inspect.getfullargspec()
  return _inspect.getargspec(target)
Using TensorFlow backend.
/home/minhvu/anaconda3/envs/py36/lib/python3.6/importlib/_bootstrap.py:219: ImportWarning: can't resolve package from __spec__ or __package__, falling back on __name__ and __path__
  return f(*args, **kwds)
/home/minhvu/anaconda3/envs/py36/lib/python3.6/importlib/_bootstrap.py:219: RuntimeWarning: numpy.dtype size changed, may indicate binary incompatibility. Expected 96, got 88
  return f(*args, **kwds)
/home/minhvu/anaconda3/envs/py36/lib/python3.6/importlib/_bootstrap.py:219: RuntimeWarning: numpy.dtype size changed, may indicate binary incompatibility
  return f(*args, **kwds)

dense_9_0_conv2D (Conv3D)       (None, 16, 64, 64, 6 103680      leaky_re_lu_43[0][0]             
__________________________________________________________________________________________________
concatenate_45 (Concatenate)    (None, 256, 64, 64,  0           concatenate_44[0][0]             
                                                                 dense_9_0_conv2D[0][0]           
__________________________________________________________________________________________________
dense_9_1_in (InstanceNormaliza (None, 256, 64, 64,  512         concatenate_45[0][0]             
__________________________________________________________________________________________________
leaky_re_lu_44 (LeakyReLU)      (None, 256, 64, 64,  0           dense_9_1_in[0][0]               
__________________________________________________________________________________________________
dense_9_1_conv2D (Conv3D)       (None, 16, 64, 64, 6 110592      leaky_re_lu_44[0][0]             
__________________________________________________________________________________________________
concatenate_46 (Concatenate)    (None, 272, 64, 64,  0           concatenate_45[0][0]             
                                                                 dense_9_1_conv2D[0][0]           
__________________________________________________________________________________________________
dense_9_2_in (InstanceNormaliza (None, 272, 64, 64,  544         concatenate_46[0][0]             
__________________________________________________________________________________________________
leaky_re_lu_45 (LeakyReLU)      (None, 272, 64, 64,  0           dense_9_2_in[0][0]               
__________________________________________________________________________________________________
dense_9_2_conv2D (Conv3D)       (None, 16, 64, 64, 6 117504      leaky_re_lu_45[0][0]             
__________________________________________________________________________________________________
concatenate_47 (Concatenate)    (None, 288, 64, 64,  0           concatenate_46[0][0]             
                                                                 dense_9_2_conv2D[0][0]           
__________________________________________________________________________________________________
dense_9_3_in (InstanceNormaliza (None, 288, 64, 64,  576         concatenate_47[0][0]             
__________________________________________________________________________________________________
leaky_re_lu_46 (LeakyReLU)      (None, 288, 64, 64,  0           dense_9_3_in[0][0]               
__________________________________________________________________________________________________
dense_9_3_conv2D (Conv3D)       (None, 16, 64, 64, 6 124416      leaky_re_lu_46[0][0]             
__________________________________________________________________________________________________
concatenate_49 (Concatenate)    (None, 64, 64, 64, 6 0           dense_9_0_conv2D[0][0]           
                                                                 dense_9_1_conv2D[0][0]           
                                                                 dense_9_2_conv2D[0][0]           
                                                                 dense_9_3_conv2D[0][0]           
__________________________________________________________________________________________________
tr_up_4_conv2DT (Conv3DTranspos (None, 64, 128, 128, 110656      concatenate_49[0][0]             
__________________________________________________________________________________________________
concatenate_50 (Concatenate)    (None, 176, 128, 128 0           tr_up_4_conv2DT[0][0]            
                                                                 concatenate_4[0][0]              
__________________________________________________________________________________________________
dense_10_0_in (InstanceNormaliz (None, 176, 128, 128 352         concatenate_50[0][0]             
__________________________________________________________________________________________________
leaky_re_lu_47 (LeakyReLU)      (None, 176, 128, 128 0           dense_10_0_in[0][0]              
__________________________________________________________________________________________________
dense_10_0_conv2D (Conv3D)      (None, 16, 128, 128, 76032       leaky_re_lu_47[0][0]             
__________________________________________________________________________________________________
concatenate_51 (Concatenate)    (None, 192, 128, 128 0           concatenate_50[0][0]             
                                                                 dense_10_0_conv2D[0][0]          
__________________________________________________________________________________________________
dense_10_1_in (InstanceNormaliz (None, 192, 128, 128 384         concatenate_51[0][0]             
__________________________________________________________________________________________________
leaky_re_lu_48 (LeakyReLU)      (None, 192, 128, 128 0           dense_10_1_in[0][0]              
__________________________________________________________________________________________________
dense_10_1_conv2D (Conv3D)      (None, 16, 128, 128, 82944       leaky_re_lu_48[0][0]             
__________________________________________________________________________________________________
concatenate_52 (Concatenate)    (None, 208, 128, 128 0           concatenate_51[0][0]             
                                                                 dense_10_1_conv2D[0][0]          
__________________________________________________________________________________________________
dense_10_2_in (InstanceNormaliz (None, 208, 128, 128 416         concatenate_52[0][0]             
__________________________________________________________________________________________________
leaky_re_lu_49 (LeakyReLU)      (None, 208, 128, 128 0           dense_10_2_in[0][0]              
__________________________________________________________________________________________________
dense_10_2_conv2D (Conv3D)      (None, 16, 128, 128, 89856       leaky_re_lu_49[0][0]             
__________________________________________________________________________________________________
concatenate_53 (Concatenate)    (None, 224, 128, 128 0           concatenate_52[0][0]             
                                                                 dense_10_2_conv2D[0][0]          
__________________________________________________________________________________________________
dense_10_3_in (InstanceNormaliz (None, 224, 128, 128 448         concatenate_53[0][0]             
__________________________________________________________________________________________________
leaky_re_lu_50 (LeakyReLU)      (None, 224, 128, 128 0           dense_10_3_in[0][0]              
__________________________________________________________________________________________________
dense_10_3_conv2D (Conv3D)      (None, 16, 128, 128, 96768       leaky_re_lu_50[0][0]             
__________________________________________________________________________________________________
concatenate_54 (Concatenate)    (None, 240, 128, 128 0           concatenate_53[0][0]             
                                                                 dense_10_3_conv2D[0][0]          
__________________________________________________________________________________________________
conv3d_1 (Conv3D)               (None, 3, 128, 128,  720         concatenate_54[0][0]             
__________________________________________________________________________________________________
activation_1 (Activation)       (None, 3, 128, 128,  0           conv3d_1[0][0]                   
==================================================================================================
Total params: 6,154,192
Trainable params: 6,154,192
Non-trainable params: 0
__________________________________________________________________________________________________
------------------------------------------------------------
# start training
------------------------------------------------------------
0.001 0.2
Traceback (most recent call last):
  File "brats/train.py", line 258, in <module>
    main()
  File "brats/train.py", line 254, in main
    loss=loss)
  File "brats/train.py", line 219, in train
    n_epochs=config["n_epochs"]
  File "/home/minhvu/github/3DUnetCNN_BRATS/unet3d/training.py", line 108, in train_model
    early_stopping_patience=early_stopping_patience))
  File "/home/minhvu/anaconda3/envs/py36/lib/python3.6/site-packages/comet_ml/monkey_patching.py", line 243, in wrapper
    return_value = original(*args, **kwargs)
  File "/home/minhvu/anaconda3/envs/py36/lib/python3.6/site-packages/keras/legacy/interfaces.py", line 91, in wrapper
    return func(*args, **kwargs)
  File "/home/minhvu/anaconda3/envs/py36/lib/python3.6/site-packages/keras/engine/training.py", line 1418, in fit_generator
    initial_epoch=initial_epoch)
  File "/home/minhvu/anaconda3/envs/py36/lib/python3.6/site-packages/keras/engine/training_generator.py", line 40, in fit_generator
    model._make_train_function()
  File "/home/minhvu/anaconda3/envs/py36/lib/python3.6/site-packages/keras/engine/training.py", line 509, in _make_train_function
    loss=self.total_loss)
  File "/home/minhvu/anaconda3/envs/py36/lib/python3.6/site-packages/keras/legacy/interfaces.py", line 91, in wrapper
    return func(*args, **kwargs)
  File "/home/minhvu/anaconda3/envs/py36/lib/python3.6/site-packages/keras/optimizers.py", line 475, in get_updates
    grads = self.get_gradients(loss, params)
  File "/home/minhvu/anaconda3/envs/py36/lib/python3.6/site-packages/keras/optimizers.py", line 89, in get_gradients
    grads = K.gradients(loss, params)
  File "/home/minhvu/github/3DUnetCNN_BRATS/external/gradient_checkpointing/memory_saving_gradients.py", line 27, in gradients_memory
    return gradients(ys, xs, grad_ys, checkpoints='memory', **kwargs)
  File "/home/minhvu/github/3DUnetCNN_BRATS/external/gradient_checkpointing/memory_saving_gradients.py", line 143, in gradients
    raise Exception('unable to find bottleneck tensors! please provide checkpoint nodes manually, or use checkpoints="speed".')
Exception: unable to find bottleneck tensors! please provide checkpoint nodes manually, or use checkpoints="speed".
Closing remaining open files:/home/minhvu/github/3DUnetCNN_BRATS/brats/database/data/test_brats_2018_is-160-192-128_crop-1_bias-1_denoise-bm4d_norm-01_hist-1_data.h5...done
